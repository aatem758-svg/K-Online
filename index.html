<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>КотоБанк</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="apple-mobile-web-app-title" content="К-Онлайн">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="mobile-web-app-capable" content="yes">

<link rel="apple-touch-icon" href="https://i.postimg.cc/3Jp6C40b/IMG-2667.jpg">
<link rel="icon" href="https://i.postimg.cc/3Jp6C40b/IMG-2667.jpg">

<style>
* {
box-sizing: border-box;
font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
-webkit-tap-highlight-color: transparent; /* Убирает синюю рамку при нажатии на iPhone */
}
body {
margin: 0;
background: #f2f3f5;
overscroll-behavior: none; /* Запрещает "резиновый" скролл в браузере */
}
.screen {
display: none;
min-height: 100vh;
padding: 20px;
}
.screen.active { display: block; }
h1 { margin: 20px 0; font-size: 28px; }

.card {
background: #fff;
border-radius: 24px;
padding: 20px;
margin-top: 20px;
box-shadow: 0 4px 12px rgba(0,0,0,0.03);
}
.balance {
font-size: 34px;
font-weight: 700;
}
.small { color: #777; font-size: 14px; }

/* LOGIN */
.login-header { text-align: center; margin-top: 60px; }
.avatar {
width: 80px; height: 80px;
border-radius: 50%;
background: #ddd;
margin: 0 auto 15px;
background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/T-Bank_Logo.svg/1200px-T-Bank_Logo.svg.png');
background-size: cover;
}
.pin-dots span {
width: 12px; height: 12px;
background: #ccc;
border-radius: 50%;
display: inline-block;
margin: 6px;
}
.pin-dots span.filled { background: #000; }
.keypad {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 15px;
max-width: 320px;
margin: 40px auto;
}
.keypad button {
height: 70px;
font-size: 26px;
border-radius: 35px;
border: none;
background: #fff;
cursor: pointer;
transition: background 0.2s;
}
.keypad button:active { background: #eee; }

/* CARD SCREEN */
.card-header {
background: linear-gradient(135deg, #2b2b2b, #6a2b7b);
color: #fff;
border-radius: 24px;
padding: 20px;
}
.btn-row {
display: flex;
gap: 12px;
margin-top: 20px;
}
.btn {
flex: 1;
padding: 16px;
border-radius: 18px;
border: none;
background: #e8f0ff;
color: #1a4fff;
font-size: 16px;
font-weight: 600;
cursor: pointer;
}
.primary { background:#ffdd2d; color:#000; width:100%; font-weight: 700; }
.bonuses { margin-top:14px; font-size:15px; }

/* HISTORY */
.history-item {
background: #fff;
border-radius: 16px;
padding: 12px;
margin-top: 10px;
font-size: 14px;
display: flex;
justify-content: space-between;
}

/* MODAL */
.modal {
position: fixed;
inset: 0;
background: rgba(0,0,0,.45);
display: none;
align-items: center;
justify-content: center;
z-index: 100;
}
.modal.active { display: flex; }
.modal-box {
background: #fff;
width: 90%;
max-width: 320px;
border-radius: 24px;
padding: 20px;
}
.modal-box button {
width: 100%;
padding: 16px;
margin-top: 12px;
border-radius: 18px;
border: none;
font-size: 16px;
font-weight: 600;
}
.secondary { background: #f1f2f4; }
.back {
background:none;
border:none;
font-size:18px;
padding: 10px 0;
cursor: pointer;
}
</style>
</head>

<body>

<div class="screen active" id="nameScreen">
<h1>Вход</h1>
<div class="card">
<input id="loginInput"
placeholder="Имя или номер телефона"
style="width:100%;padding:16px;font-size:16px;border-radius:16px;border:1px solid #ddd; outline: none;">
<button class="btn primary" style="margin-top:16px" onclick="findClient()">Продолжить</button>
<div id="nameError" style="color:red;margin-top:10px;font-size:14px"></div>
<div id="variants"></div>
</div>
</div>

<div class="screen" id="login">
<div class="login-header">
<div class="avatar"></div>
<h1 id="loginName"></h1>
<div class="pin-dots" id="dots"></div>
</div>
<div class="keypad" id="keypad"></div>
</div>

<div class="screen" id="home">
<h1 id="homeName"></h1>

<div class="card">
<div class="small">Все траты</div>
<div class="balance" id="allSpending"></div>
<div class="small" id="monthSpending"></div>
</div>

<div class="card" onclick="openCard()">
<div class="small">Карта</div>
<div class="balance" id="homeBalance"></div>
</div>
</div>

<div class="screen" id="card">
<button class="back" onclick="goHome()">← Назад</button>

<div class="card-header">
<div class="small">Баланс карты</div>
<div class="balance" id="cardBalance"></div>
</div>

<div class="btn-row">
<button class="btn">Пополнить</button>
<button class="btn" onclick="openPay()">Оплатить</button>
</div>

<div class="bonuses" id="bonusText"></div>

<h3 style="margin-top:20px">История операций</h3>
<div id="historyList"></div>
</div>

<div class="modal" id="payModal">
<div class="modal-box">
<button class="primary" onclick="payQR()">Оплата по QR</button>
<button class="secondary" onclick="payTransfer()">Перевести</button>
<button class="secondary" onclick="closePay()">Закрыть</button>
</div>
</div>

<script>
const CURRENT_MONTH = "декабре";

/* ===== КЛИЕНТЫ ===== */
const clients = [
{
name: "Артём",
phone: "+79117961522",
pin: "1234",
balance: 14216,
monthlySpending: 640,
bonuses: 1250,
history: [{ text:"Покупка: Магазин", amount:-540 }, { text:"Перевод", amount:-100 }]
},
{
name: "Даня",
phone: "+79673657830",
pin: "1115",
balance: 9000,
monthlySpending: 1405,
bonuses: 3,
history: [{ text:"Перевод", amount:-100 }, { text:"Оплата QR Пятёрочка", amount:-1000 }]
},
{
name: "Роман",
phone: "+79062357433",
pin: "2025",
balance: 8200,
monthlySpending: 102,
bonuses: 0,
history: []
},
  {
name: "Алексей",
phone: "+0",
pin: "4711",
balance: 1005,
monthlySpending: 25,
bonuses: 2,
history: []
},
  {
name: "Матвей",
phone: "+79017362415",
pin: "2212",
balance: 1000,
monthlySpending: 300,
bonuses: 2,
history: []
},
  {
name: "Тимофей",
phone: "+79028716109",
pin: "6767",
balance: 8200,
monthlySpending: 1200,
bonuses: 25,
history: [{ text:"Перевод", amount:-100} ]
},
  {
name: "Артём",
phone: "+78907631890",
pin: "1984",
balance: 4500,
monthlySpending: 250,
bonuses: 0,
history: []
},
  {
name: "Михаил",
phone: "+0",
pin: "3456",
balance: 4500,
monthlySpending: 500,
bonuses: 4,
history: []
},
  {
name: "Святослав",
phone: "+375298880088",
pin: "3553",
balance: 15000,
monthlySpending: 5000,
bonuses: 402,
history: []
}
];

// Дополнение списка до 30 для примера
while (clients.length < 30) {
clients.push({
name: "Клиент " + (clients.length + 1),
phone: "+7999000" + (3000 + clients.length),
pin: String(1111 + clients.length),
balance: 1000,
monthlySpending: 0,
bonuses: 0,
history: []
});
}

let currentClient = null;
let enteredPin = "";

function findClient() {
const v = loginInput.value.trim();
nameError.innerText = "";
variants.innerHTML = "";

if (!v) {
nameError.innerText = "Введите имя или телефон";
return;
}

if (v.startsWith("+")) {
const c = clients.find(x => x.phone === v);
if (!c) { nameError.innerText="Клиент не найден"; return; }
selectClient(c);
return;
}

const matches = clients.filter(
c => c.name.toLowerCase() === v.toLowerCase()
);

if (matches.length === 0) {
nameError.innerText = "Клиент не найден";
return;
}

if (matches.length === 1) {
selectClient(matches[0]);
return;
}

matches.forEach(c => {
const d = document.createElement("div");
d.className = "card";
d.style.cursor = "pointer";
d.innerText = `${c.name} ••• ${c.phone.slice(-4)}`;
d.onclick = () => selectClient(c);
variants.appendChild(d);
});
}

function selectClient(c) {
currentClient = c;
enteredPin = "";
loginName.innerText = c.name;
dots.innerHTML = "";
for (let i=0;i<4;i++) dots.appendChild(document.createElement("span"));
switchScreen("login");
}

/* КЛАВИАТУРА */
[1,2,3,4,5,6,7,8,9,"",0,"←"].forEach(k=>{
const b=document.createElement("button");
b.innerText=k;
if (k === "") b.style.visibility = "hidden";
b.onclick=()=>pressKey(k);
keypad.appendChild(b);
});

function pressKey(k){
if(k==="←") enteredPin=enteredPin.slice(0,-1);
else if(k !== "" && enteredPin.length<4) enteredPin+=k;

const dotElements = dots.children;
for(let i=0; i<4; i++) {
dotElements[i].classList.toggle("filled", i < enteredPin.length);
}

if(enteredPin.length === 4) {
if(enteredPin === currentClient.pin) {
showHome();
} else {
enteredPin = "";
setTimeout(() => {
for(let i=0; i<4; i++) dotElements[i].classList.remove("filled");
}, 200);
}
}
}

function showHome(){
switchScreen("home");
homeName.innerText=currentClient.name;
homeBalance.innerText=currentClient.balance.toLocaleString("ru-RU")+" ₽";
allSpending.innerText=currentClient.monthlySpending.toLocaleString("ru-RU")+" ₽";
monthSpending.innerText="Трат в "+CURRENT_MONTH+": "+currentClient.monthlySpending.toLocaleString("ru-RU")+" ₽";
}

function openCard(){
switchScreen("card");
cardBalance.innerText=currentClient.balance.toLocaleString("ru-RU")+" ₽";
bonusText.innerText="Бонусы: "+currentClient.bonuses;
historyList.innerHTML="";
currentClient.history.slice().reverse().forEach(h=>{
const d=document.createElement("div");
d.className="history-item";
d.innerHTML=`<span>${h.text}</span> <span style="font-weight:700">${h.amount} ₽</span>`;
historyList.appendChild(d);
});
}

function goHome(){ showHome(); }

function switchScreen(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
window.scrollTo(0,0);
}

function openPay(){ payModal.classList.add("active"); }
function closePay(){ payModal.classList.remove("active"); }

function payTransfer(){
addHistory("Перевод",-500);
window.location.href="https://docs.google.com/forms/d/e/1FAIpQLSfKTieRxBc0BpZt79ZHjVrK1yxGdogC4wgwnlYjx0JjW7rADg/viewform";
}

function payQR(){
addHistory("Оплата по QR",-300);
// ЗАМЕНИ ТУТ ССЫЛКУ на свой репозиторий со сканером на GitHub
window.location.href="https://твой-логин.github.io/scanner/";
}

function addHistory(t,a){
currentClient.balance+=a;
currentClient.monthlySpending+=Math.abs(a);
currentClient.history.push({text:t,amount:a});
}
</script>

</body>
</html>
